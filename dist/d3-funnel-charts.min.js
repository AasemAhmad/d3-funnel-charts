!function(){var a=400,b=600,c=1/3;window.FunnelChart=function(d){this.data=d.data,this.totalEngagement=0;for(var e=0;e<this.data.length;e++)this.totalEngagement+=this.data[e][1];this.width="undefined"!=typeof d.width?d.width:b,this.height="undefined"!=typeof d.height?d.height:a;var f="undefined"!=typeof d.bottomPct?d.bottomPct:c;this._slope=2*this.height/(this.width-f*this.width),this._totalArea=(this.width+f*this.width)*this.height/2},window.FunnelChart.prototype._getLabel=function(a){return this.data[a][0]},window.FunnelChart.prototype._getEngagementCount=function(a){return this.data[a][1]},window.FunnelChart.prototype._createPaths=function(){function a(b,c,d,e,f){f>=b.data.length||(area=b.data[f][1]*b._totalArea/b.totalEngagement,prevBaseLength=d-c,nextBaseLength=Math.sqrt((b._slope*prevBaseLength*prevBaseLength-4*area)/b._slope),nextLeftX=(prevBaseLength-nextBaseLength)/2+c,nextRightX=d-(prevBaseLength-nextBaseLength)/2,nextHeight=b._slope*(prevBaseLength-nextBaseLength)/2+e,points=[[nextRightX,nextHeight]],points.push([d,e]),points.push([c,e]),points.push([nextLeftX,nextHeight]),points.push([nextRightX,nextHeight]),trapezoids.push(points),a(b,nextLeftX,nextRightX,nextHeight,f+1))}return trapezoids=[],a(this,0,this.width,0,0),trapezoids},window.FunnelChart.prototype.draw=function(a,b){function c(a,d){var i=e.append("svg:path").attr("d",function(){return f([h[d][0],h[d][1],h[d][2],h[d][2],h[d][1],h[d][2]])}).attr("fill","#fff");nextHeight=h[d][[h[d].length]-1];var j=i.node().getTotalLength(),k=i.transition().duration(j/b).ease("linear").attr("d",function(){return f(h[d])}).attr("fill",function(){return g(d)});e.append("svg:text").text(a._getLabel(d)+": "+a._getEngagementCount(d)).attr("x",function(){return a.width/2}).attr("y",function(){return(h[d][0][1]+h[d][1][1])/2}).attr("text-anchor","middle").attr("dominant-baseline","middle").attr("fill","#fff"),d<h.length-1&&k.each("end",function(){c(a,d+1)})}var d=2.5;b="undefined"!=typeof b?b:d;var e=d3.select(a).append("svg:svg").attr("width",this.width).attr("height",this.height).append("svg:g"),f=d3.svg.line().x(function(a){return a[0]}).y(function(a){return a[1]}),g=d3.scale.category10(),h=this._createPaths();c(this,0)}}();