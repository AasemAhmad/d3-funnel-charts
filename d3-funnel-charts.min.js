(function(){var e=400,t=600,n=1/3;window.FunnelChart=function(r){this.data=r.data;this.totalEngagement=0;for(var i=0;i<data.length;i++){this.totalEngagement+=data[i][1]}this.width=typeof r.width!=="undefined"?r.width:t;this.height=typeof r.height!=="undefined"?r.height:e;var s=typeof r.bottomPct!=="undefined"?r.bottomPct:n;this._slope=2*this.height/(this.width-s*this.width);this._totalArea=(this.width+s*this.width)*this.height/2};window.FunnelChart.prototype._getLabel=function(e){return this.data[e][0]};window.FunnelChart.prototype._getEngagementCount=function(e){return this.data[e][1]};window.FunnelChart.prototype._createPaths=function(){function e(t,n,r,i,s){if(s>=t.data.length)return;area=t.data[s][1]*t._totalArea/t.totalEngagement;prevBaseLength=r-n;nextBaseLength=Math.sqrt((t._slope*prevBaseLength*prevBaseLength-4*area)/t._slope);nextLeftX=(prevBaseLength-nextBaseLength)/2+n;nextRightX=r-(prevBaseLength-nextBaseLength)/2;nextHeight=t._slope*(prevBaseLength-nextBaseLength)/2+i;points=[[nextRightX,nextHeight]];points.push([r,i]);points.push([n,i]);points.push([nextLeftX,nextHeight]);points.push([nextRightX,nextHeight]);trapezoids.push(points);e(t,nextLeftX,nextRightX,nextHeight,s+1)}trapezoids=[];e(this,0,this.width,0,0);return trapezoids};window.FunnelChart.prototype.draw=function(e,t){function u(e,n){var a=r.append("svg:path").attr("d",function(e){return i([o[n][0],o[n][1],o[n][2],o[n][2],o[n][1],o[n][2]])}).attr("fill","#fff");nextHeight=o[n][[o[n].length]-1];var f=a.node().getTotalLength();var l=a.transition().duration(f/t).ease("linear").attr("d",function(e){return i(o[n])}).attr("fill",function(e){return s(n)});r.append("svg:text").text(e._getLabel(n)+": "+e._getEngagementCount(n)).attr("x",function(t){return e.width/2}).attr("y",function(e){return(o[n][0][1]+o[n][1][1])/2}).attr("text-anchor","middle").attr("dominant-baseline","middle").attr("fill","#fff");if(n<o.length-1){l.each("end",function(){u(e,n+1)})}}var n=2.5;t=typeof t!=="undefined"?t:n;var r=d3.select(e).append("svg:svg").attr("width",this.width).attr("height",this.height).append("svg:g");var i=d3.svg.line().x(function(e){return e[0]}).y(function(e){return e[1]});var s=d3.scale.category10();var o=this._createPaths();u(this,0)}})();